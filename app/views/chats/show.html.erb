<%= turbo_frame_tag :chat do %>
  <div class="flex flex-col w-full h-full">
    <div class="w-full bg-[#2e2e2e] text-gray-100 p-3 rounded mb-4 flex items-center gap-4">
      <div class="text-sm text-gray-300">Schema:</div>

      <%= form_with model: @chat,
                    url: chat_schema_path(@chat),
                    method: :patch,
                    data: { turbo_frame: :chat },
                    class: "flex items-center" do |f| %>

        <%= f.select :structured_schema_id,
          options_from_collection_for_select(
            StructuredSchema.order(:name),
            :id, :name,
            @chat.structured_schema_id
          ),
          { include_blank: "Select schemaâ€¦" },
          class: "bg-gray-700 text-gray-100 rounded p-1",
          onchange: "this.form.requestSubmit()" %>
      <% end %>
    </div>

    <div class="mb-4 p-4 bg-gray-900 text-gray-200 rounded-lg">
      <%= turbo_frame_tag "schema_panel_#{@chat.id}" do %>
        <%= render "schema_panel", chat: @chat %>
      <% end %>
    </div>

    <%= turbo_stream_from(dom_id(@chat, :messages)) %>
    <%= turbo_frame_tag(:messages, src: messages_path(chat_id: @chat.id)) %>
    <%= turbo_frame_tag(:new_message, src: new_message_path(chat_id: @chat.id))  %>
  </div>
<% end %>

